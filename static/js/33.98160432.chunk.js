(this["webpackJsonpmelodition-typescript"]=this["webpackJsonpmelodition-typescript"]||[]).push([[33],{308:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(65),o=n(0),i=n.n(o),r=n(191),c=n(448),l=n(449),s=n(283),d=function(e){var t=e.loading,n=Object(o.useState)(!1),d=Object(a.a)(n,2),u=d[0],f=d[1],m=function(){u?(Object(s.o)(),f(!1)):(Object(s.n)(),f(!0))},h=function(e){"Space"!==e.code||t||m()};return Object(o.useEffect)((function(){return document.addEventListener("keyup",h),function(){document.removeEventListener("keyup",h)}})),i.a.createElement(r.a,{id:"play-button",color:"secondary","aria-label":"play song",onClick:m},u?i.a.createElement(c.a,{style:{fontSize:"1.8em"}}):i.a.createElement(l.a,{style:{fontSize:"1.8em"}}))}},309:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return d}));var a=n(73),o=n(283),i=[1,2,4,6,7,9,11,13,14,16,18,19,21,23,25,26,28,30,31,33,35,37,38,40,42],r=[0,2,4,6,7,9,11,12,14,16,18,19,21,23,24,26,28,30,31,33,35,36,38,40,42,43,45,47],c=function(e){var t=e%12,n="C";return 1===t&&(n="Db"),2===t&&(n="D"),3===t&&(n="Eb"),4===t&&(n="E"),5===t&&(n="F"),6===t&&(n="Gb"),7===t&&(n="G"),8===t&&(n="Ab"),9===t&&(n="A"),10===t&&(n="Bb"),11===t&&(n="B"),""+n},l=function(e){return 101===e||81===e||60===e||40===e},s={z:48,s:49,x:50,d:51,c:52,v:53,g:54,b:55,h:56,n:57,j:58,m:59,",":60,l:61,".":62,";":63,"/":64,q:65,2:66,w:67,3:68,e:69,4:70,r:71,t:72,6:73,y:74,7:75,u:76,i:77,9:78,o:79,0:80,p:81,"-":82,"[":83,"]":84},d=function e(){var t=this;Object(a.a)(this,e),this.isDown=!1,this.playedKey=void 0,this.keyboardUp=function(e){e.preventDefault();var n=e.key;if(s.hasOwnProperty(n)){var a=s[n];Object(o.h)(a),t.playedKey=null}},this.keyboardDown=function(e){e.preventDefault();var n=e.key;if(s.hasOwnProperty(n)&&n!==t.playedKey){var a=s[n];Object(o.i)(a),t.playedKey=n}},this.mouseUpReset=function(){t.isDown=!1},this.mouseDown=function(e){e.preventDefault();var n=e.currentTarget.tabIndex;t.isDown=!0,t.playedKey=n,Object(o.i)(n)},this.mouseOver=function(e){e.preventDefault();var n=e.currentTarget.tabIndex;t.isDown&&n!==t.playedKey&&(t.playedKey=n,Object(o.i)(n))},this.mouseLeave=function(e){e.preventDefault();var n=e.currentTarget.tabIndex;t.isDown&&(Object(o.h)(n),t.playedKey=null)},this.mouseUp=function(e){e.preventDefault();var n=e.currentTarget.tabIndex;t.isDown=!1,Object(o.h)(n),t.playedKey=null}}},317:function(e,t,n){"use strict";var a=n(0),o=n.n(a),i=n(35),r=n(22),c=n(283),l=n(309),s=n(189),d=n(182),u=n(348),f=[{note:"C",xPos:47,yPos:205,id:"white",front:"M0.5 0.5H42.5V155.5C42.5 156.881 43.6193 158 45 158H79.5V245C79.5 247.485 77.4853 249.5 75 249.5H5C2.51472 249.5 0.5 247.485 0.5 245V0.5Z"},{note:"Db",xPos:77,yPos:95,id:"black",front:"M95 0H45V153C45 154.105 45.8954 155 47 155H93C94.1046 155 95 154.105 95 153V0Z",back:"M79 130H61C52 130 52 150 52 150H88C88 150 88 130 79 130Z"},{note:"D",xPos:130,yPos:205,id:"white",front:"M150.5 0.5H97.5V155.5C97.5 156.881 96.3807 158 95 158H84.5V245C84.5 247.485 86.5147 249.5 89 249.5H159C161.485 249.5 163.5 247.485 163.5 245V158H153C151.619 158 150.5 156.881 150.5 155.5V0.5Z"},{note:"Eb",xPos:185,yPos:95,id:"black",front:"M203 0H153V153C153 154.105 153.895 155 155 155H201C202.105 155 203 154.105 203 153V0Z",back:"M187 130H169C160 130 160 150 160 150H196C196 150 196 130 187 130Z"},{note:"E",xPos:214,yPos:205,id:"white",front:"M247.5 0.5H205.5V155.5C205.5 156.881 204.381 158 203 158H168.5V245C168.5 247.485 170.515 249.5 173 249.5H243C245.485 249.5 247.5 247.485 247.5 245V0.5Z"},{note:"F",xPos:298,yPos:205,id:"white",front:"M252.5 0.5H291.5V155.5C291.5 156.881 292.619 158 294 158H331.5V245C331.5 247.485 329.485 249.5 327 249.5H257C254.515 249.5 252.5 247.485 252.5 245V0.5Z"},{note:"Gb",xPos:327,yPos:95,id:"black",front:"M344 0H294V153C294 154.105 294.895 155 296 155H342C343.105 155 344 154.105 344 153V0Z",back:"M328 130H310C301 130 301 150 301 150H337C337 150 337 130 328 130Z"},{note:"G",xPos:383,yPos:205,id:"white",front:"M390.5 0.5H346.5V155.5C346.5 156.881 345.381 158 344 158H336.5V245C336.5 247.485 338.515 249.5 341 249.5H411C413.485 249.5 415.5 247.485 415.5 245V158H393C391.619 158 390.5 156.881 390.5 155.5V0.5Z"},{note:"Ab",xPos:427,yPos:95,id:"black",front:"M443 0H393V153C393 154.105 393.895 155 395 155H441C442.105 155 443 154.105 443 153V0Z",back:"M427 130H409C400 130 400 150 400 150H436C436 150 436 130 427 130Z"},{note:"A",xPos:466,yPos:205,id:"white",front:"M491.5 0.5H445.5V155.5C445.5 156.881 444.381 158 443 158H420.5V245C420.5 247.485 422.515 249.5 425 249.5H495C497.485 249.5 499.5 247.485 499.5 245V158H494C492.619 158 491.5 156.881 491.5 155.5V0.5Z"},{note:"Bb",xPos:526,yPos:95,id:"black",front:"M544 0H494V153C494 154.105 494.895 155 496 155H542C543.105 155 544 154.105 544 153V0Z",back:"M528 130H510C501 130 501 150 501 150H537C537 150 537 130 528 130Z"},{note:"B",xPos:551,yPos:205,id:"white",front:"M583.5 0.5H546.5V155.5C546.5 156.881 545.381 158 544 158H504.5V245C504.5 247.485 506.515 249.5 509 249.5H579C581.485 249.5 583.5 247.485 583.5 245V0.5Z"},{note:"C",xPos:637,yPos:205,id:"white",front:"M663 249.5H593C590.515 249.5 588.5 247.485 588.5 245V0.5H667.5V245C667.5 247.485 665.485 249.5 663 249.5Z"}],m=Object(s.a)((function(e){return Object(d.a)({root:{display:"flex",flexDirection:"row-reverse",justifyContent:"center",flexWrap:"nowrap",margin:"0 auto",minWidth:"215px",width:"100%",cursor:"default","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",touchAction:"none"},back:{margin:e.spacing(0,2)}})})),h=Object(i.c)((function(e){return{theme:e.auth.theme,Melo:e.melodition}}),(function(e){return{drawGamePiano:Object(r.b)(c.g,e),drawNotePiano:Object(r.b)(c.j,e)}}))((function(e){var t=e.Melo,n=e.drawGamePiano,i=e.drawNotePiano,r=new l.a,c=r.keyboardDown,s=r.keyboardUp,d=r.mouseDown,h=r.mouseUp,v=r.mouseLeave,b=r.mouseOver,p=36,y=36,g={};Object(a.useEffect)((function(){return console.log("Piano mounted"),Object(u.changeMidi)(!0),document.addEventListener("keydown",c),document.addEventListener("keyup",s),function(){console.log("Piano disMounted"),Object(u.changeMidi)(!1),document.removeEventListener("keydown",c),document.removeEventListener("keyup",s)}}),[t.loading,c,s]);var w,k=m(),x=function(e){if(e){var t=e.tabIndex;g[t]=e}};return(w=t.octave)>6?(p=24,y=24):w>3?(p=36,y=36):w>1?(p=48,y=48):(p=60,y=60),o.a.createElement("div",{ref:function(e){if(e&&t.pianoLoading){var a=e.getBoundingClientRect(),o=a.width,r=Math.floor(window.innerHeight-(a.height+64));if(t.playMode){var c=function(e){var n=4*t.bpm;return e/n}(r),s=c*(t.bpm<=4?4:t.bpm)+8,d=a.left;n(g,{width:o,height:r,baseLine:s,pianoLeft:d},c)}else if(t.noteMode&&t.neededLines){var u=t.neededLines.up>83?102:83,f=t.neededLines.down<58||t.neededLines.up>83?28:16,m=u>83?l.e:l.b,h=r/2.1/(f/2),v=o/(t.neededLines.notes+2),b=.5*v<7?7:.5*v>12?12:.5*v,p=Array.from(Array(f),(function(e,t){return u-m[t]})),y={};p.forEach((function(e,t){var n=(t+1)*h/2;y[e]={pos:n,note:Object(l.d)(e)},y[e-1]={pos:n,note:Object(l.d)(e-1)}})),i(g,{width:o,height:r/2.1,tapSize:h,spaceSize:v,fontSize:b,linesArray:p,notePos:y})}else n(g)}},className:k.root},Array.from(Array(t.octave),(function(e,t){return"oct"+(t+1)})).map((function(e,n){var a=t.octave-n===1?668:584;return o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",id:e,key:e,width:a,height:"100%",viewBox:"0 0 ".concat(a," 275"),fill:"none",style:n!==t.octave-1?{marginRight:8/t.octave}:void 0},f.map((function(a,i){var r,c=f.length,l=p===y?"first":a.note;t.octave-n===1&&c===i+1&&(c++,l="last",n++);var s="white"===a.id?"#B5B5B5":void 0,u="white"===a.id?"black":"rgb(255 255 255 / 65%)",m=null===(r=t.neededTracks)||void 0===r?void 0:r.some((function(e){return e.pitch+36===p})),g="white"===a.id?a.xPos:a.xPos+6;return c!==i+1&&o.a.createElement("g",{id:a.id,ref:x,onMouseUp:h,onMouseDown:d,onMouseLeave:v,onTouchEnd:v,onTouchMove:b,onTouchStart:d,key:e+"-"+a.note+n,className:l,tabIndex:p},o.a.createElement("path",{id:"back",d:a.front,fill:a.id,stroke:s}),"white"!==a.id?o.a.createElement("path",{id:"front",d:a.back,fill:u}):o.a.createElement("text",{id:"front",x:g,y:a.yPos,fill:"rgb(155 155 155)",fontSize:"25",fontWeight:"900"},a.note),m&&o.a.createElement("circle",{cx:a.xPos-8,cy:a.yPos+20,r:"6",fill:"rgb(56 56 56)",stroke:a.id,strokeWidth:"2"}),60===p++&&o.a.createElement("polygon",{points:"30,265 40,255 50,265",fill:"black"}))})))})))}));t.a=h},320:function(e,t,n){"use strict";var a=n(65),o=n(0),i=n.n(o),r=n(35),c=n(22),l=n(492),s=n(283),d=Object(r.c)((function(e){return{Melo:e.melodition}}),(function(e){return{drawSeekBar:Object(c.b)(s.f,e)}}))((function(e){var t=e.Melo,n=e.drawSeekBar,a=Object(o.useCallback)((function(e){return e&&t.seekLoading&&n({seekBar:e}),function(){}}),[t.seekLoading,n]);return i.a.createElement("div",{style:{height:"40%"}},i.a.createElement(u,{ref:a,Melo:t}))}));t.a=d;var u=Object(o.forwardRef)((function(e,t){var n=e.Melo,r=Object(o.useState)(0),c=Object(a.a)(r,2),d=c[0],u=c[1];Object(o.useImperativeHandle)(t,(function(){return{changeSeeker:f}}));var f=function(e){"number"===typeof e&&u(e)};return i.a.createElement(l.a,{color:"secondary",orientation:"vertical","aria-label":"seekbar",defaultValue:0,max:n.songLength,min:0,onChange:function(e,t){var n;"number"===typeof(n=t)&&Object(s.a)(n)},"aria-labelledby":"vertical-slider",value:d})}))},480:function(e,t,n){"use strict";n.r(t);var a=n(73),o=n(74),i=n(76),r=n(75),c=n(12),l=n(0),s=n.n(l),d=n(22),u=n(35),f=n(450),m=n(182),h=n(310),v=n(191),b=n(7),p=n(283),y=n(308),g=n(77),w=n(320),k=n(189),x=n(248),E=n(249),C=n(251),j=n(72),O=n(250),H=Object(k.a)((function(e){return Object(m.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},divider:{margin:e.spacing(0,2)}})}));function P(e){var t=e.lesson,n=e.modeChanger,a=H();return s.a.createElement(x.a,{position:"static",color:"default",className:a.root},s.a.createElement(E.a,null,s.a.createElement(v.a,{edge:"start",color:"inherit","aria-label":"menu",onClick:n},s.a.createElement(O.a,null)),s.a.createElement(C.a,{orientation:"vertical",flexItem:!0,className:a.divider}),s.a.createElement(j.a,{variant:"h6",color:"inherit",className:a.title},null===t||void 0===t?void 0:t.title)))}var M=function(e){var t,n,a=e.Melo,o=e.drawGame;return s.a.createElement("canvas",{ref:function(e){return function(e){e&&a.gameLoading&&a.canvasSize&&o(e)}(e)},width:null===(t=a.canvasSize)||void 0===t?void 0:t.width,height:null===(n=a.canvasSize)||void 0===n?void 0:n.height,style:{position:"absolute",top:0,left:0,zIndex:2},onWheel:function(e){return Object(p.a)(e)}})},V=function(e){var t,n,a=e.Melo;return s.a.createElement("canvas",{ref:function(e){return function(e){if(e&&a.canvasSize&&a.gameLoading){var t=e.getContext("2d");t.clearRect(0,0,a.canvasSize.width,a.canvasSize.height);var n=a.pianoSize,o=n?n.length-1:61,i=n?n[o].width:.5,r=a.canvasSize.height;null===n||void 0===n||n.forEach((function(e,n){t.beginPath();var a=e.left;"CF"===e.key||"last"===e.key?(t.moveTo(a,0),t.lineTo(a,r),t.lineWidth=i,t.strokeStyle="rgba(50,50,50,0.8)",t.stroke()):"black"===e.key&&(t.rect(a,0,e.width,r),t.fillStyle="rgba(0,0,0,0.4)",t.fill())}))}}(e)},width:null===(t=a.canvasSize)||void 0===t?void 0:t.width,height:null===(n=a.canvasSize)||void 0===n?void 0:n.height,style:{zIndex:1}})},S=function(e){var t=e.width,n=e.baseLine;return s.a.createElement("svg",{width:t+7,height:n,onWheel:function(e){return Object(p.a)(e)},style:{bottom:0,left:-7,zIndex:3,position:"absolute",filter:"drop-shadow(rgba(0, 0, 0, 0.7) 0px 1px 1px)"}},s.a.createElement("style",null,"@keyframes draw{to{stroke-dashoffset:0}}"),s.a.createElement("polygon",{points:"0,0 10,8 0,16",fill:"red"}),s.a.createElement("line",{style:{strokeDasharray:t+7,strokeDashoffset:t+7,animation:"draw 1s linear forwards"},x1:0,y1:8,x2:t+7,y2:8,strokeWidth:2.5,stroke:"red"}))},z=Object(u.c)((function(e){return{Melo:e.melodition}}),(function(e){return{drawGame:Object(d.b)(p.d,e)}}))((function(e){var t,n,a=e.Melo,o=e.drawGame;return s.a.createElement("div",{style:{width:null===(t=a.canvasSize)||void 0===t?void 0:t.width,height:null===(n=a.canvasSize)||void 0===n?void 0:n.height,position:"relative",boxShadow:"inset 0 1px 4px 0px black"}},s.a.createElement(M,{Melo:a,drawGame:o}),s.a.createElement(V,{Melo:a}),a.canvasSize&&s.a.createElement(S,a.canvasSize))})),D=n(317),L=function(e){Object(i.a)(n,e);var t=Object(r.a)(n);function n(e){var o;return Object(a.a)(this,n),(o=t.call(this,e)).svgWidth=function(e){return 1===e?668:584},o.toggleDrawer=function(e){"keydown"!==e.type&&(o.state.list?o.setState({list:!1}):o.setState({list:!0}))},o.playmodeChanger=function(){o.props.changeMode(!1)},o.updateDimensions=function(){o.props.melodition.pianoLoading||o.props.resizePlayer()},o.state={list:!1},o}return Object(o.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions)}},{key:"render",value:function(){var e=this.props,t=e.classes,n=e.melodition,a=e.lesson;return s.a.createElement("div",{className:t.root},s.a.createElement(P,{modeChanger:this.playmodeChanger,lesson:a}),n.playMode?s.a.createElement(h.a,{container:!0,className:t.main},s.a.createElement(h.a,{item:!0,xs:1},s.a.createElement(h.a,{container:!0,direction:"column",justify:"center",alignItems:"center",className:t.content},s.a.createElement(y.a,{loading:n.loading}))),s.a.createElement(h.a,{item:!0,xs:10},s.a.createElement(h.a,{container:!0,direction:"column",justify:"center",alignItems:"center",className:t.content},s.a.createElement(h.a,{item:!0,xs:12},n.pianoLoading?s.a.createElement(g.a,{noPad:!0}):s.a.createElement(z,null),s.a.createElement(D.a,null)))),s.a.createElement(h.a,{item:!0,xs:1},s.a.createElement(h.a,{container:!0,direction:"column",justify:"space-around",alignItems:"center",className:t.content},s.a.createElement(w.a,null),s.a.createElement(v.a,{color:"secondary","aria-label":"play mode"},s.a.createElement(f.a,null))))):s.a.createElement(h.a,{container:!0,className:t.main},s.a.createElement(g.a,null)))}}]),n}(l.Component);t.default=Object(u.c)((function(e,t){return{history:e.router.location.pathname,classes:t.classes,melodition:e.melodition,theme:e.auth.theme,lesson:e.single.lesson.data,course:e.single.course.data}}),(function(e){return{changeMode:Object(d.b)(p.b,e),drawGame:Object(d.b)(p.d,e),drawPiano:Object(d.b)(p.g,e),resizePlayer:Object(d.b)(p.m,e)}}))(Object(b.a)((function(e){var t;return Object(m.a)({root:{width:"100vw",height:"100vh",overflow:"hidden",backgroundColor:e.palette.background.paper},main:(t={width:"100vw",overflow:"hidden",minHeight:"calc(100vh - 64px)"},Object(c.a)(t,e.breakpoints.down("xs"),{minHeight:"calc(100vh - 56px)"}),Object(c.a)(t,"display","flex"),t),content:{height:"100%",width:"100%",flexWrap:"nowrap"},doubleGrid:{flexWrap:"nowrap",width:"100%",maxWidth:"100%","& > div":{margin:"auto",padding:0,height:"100%"}},centerText:{textAlign:"center"},loading:{display:"flex",height:"83%",boxShadow:"inset 0 1px 4px 0px black"}})}))(L))}}]);
//# sourceMappingURL=33.98160432.chunk.js.map